<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Part Number Generator</title>
    <style>
        /* Clock Styles */
        .jakarta-clock {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1001;
        }
        .clock-time {
            font-size: 18px;
            font-weight: bold;
        }
        .clock-date {
            font-size: 12px;
            margin-top: 3px;
        }

        /* Login Modal Styles */
        .login-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .login-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 5px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }
        .login-content h2 {
            text-align: center;
            color: #2c3e50;
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .login-form input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .login-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .login-form button:hover {
            background-color: #45a049;
        }
        .error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        
        /* Add Option Modal Styles */
        .add-option-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .add-option-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 5px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }
        .add-option-content h2 {
            text-align: center;
            color: #2c3e50;
        }
        .add-option-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .add-option-form input, .add-option-form select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .add-option-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-option-form button:hover {
            background-color: #45a049;
        }
        .form-buttons {
            display: flex;
            gap: 10px;
        }
        .cancel-btn {
            background-color: #e74c3c;
        }
        
        /* Dropdown with Add Button Styles */
        .dropdown-with-add {
            display: flex;
            gap: 5px;
        }
        .dropdown-with-add select {
            flex: 1;
        }
        .add-btn {
            padding: 8px 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-btn:hover {
            background-color: #2980b9;
        }
        .add-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        /* Pocket Input Styles */
        .pocket-input {
            display: none;
            margin-top: 10px;
        }
        
        /* Header Type Input Styles */
        .header-type-input {
            display: none;
            margin-top: 10px;
        }
        
        /* Size Code Generator Button */
        .generate-size-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .generate-size-btn:hover {
            background-color: #2980b9;
        }
        
        /* Search Box Styles */
        .search-container {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        .search-container input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-container button {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-container button:hover {
            background-color: #2980b9;
        }
        
        /* Unit Converter Styles */
        .unit-converter {
            position: fixed;
            top: 60px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            width: 250px;
        }
        .unit-converter h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #2c3e50;
            text-align: center;
        }
        .converter-input {
            display: flex;
            margin-bottom: 8px;
        }
        .converter-input input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .converter-input select {
            width: 70px;
            margin-left: 5px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .converter-result {
            margin-top: 8px;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* Main Application Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding-top: 40px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .section {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .dimensions {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .dimension-input {
            flex: 1;
        }
        .cartridge-dimensions {
            display: none;
        }
        .cartridge-dimension-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .cartridge-dimension-input {
            flex: 1;
        }
        .generate-section {
            text-align: center;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .copy-btn {
            background-color: #3498db;
            margin-left: 10px;
        }
        .copy-btn:hover {
            background-color: #2980b9;
        }
        .qr-container {
            margin-top: 15px;
            text-align: center;
        }
        .qr-value {
            text-align: left;
            margin-top: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
        }
        .flex-row {
            display: flex;
            align-items: center;
        }
        #qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }
        .save-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .save-btn {
            padding: 8px 15px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .save-btn:hover {
            background-color: #4cae4c;
        }
        .data-section {
            margin-top: 30px;
        }
        .category-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .category-tab {
            padding: 8px 15px;
            background-color: #e0e0e0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .category-tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .data-table tr:hover {
            background-color: #f1f1f1;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 3px 8px;
            font-size: 12px;
            border-radius: 3px;
        }
        .view-btn {
            background-color: #3498db;
            color: white;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        .no-data {
            text-align: center;
            padding: 20px;
            color: #777;
        }
        .clear-data-btn {
            background-color: #e74c3c;
            margin-top: 10px;
        }
        .clear-data-btn:hover {
            background-color: #c0392b;
        }
        .export-btn {
            background-color: #2ecc71;
            margin-top: 10px;
        }
        .export-btn:hover {
            background-color: #27ae60;
        }
        .farrindo-logo {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
        }
    </style>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Farrindo Logo -->
    <div class="farrindo-logo">
        <img src="https://www.farrindo.co.id/wp-content/uploads/2025/01/300x39-logofarrindo2025bawahbanget.webp" alt="Farrindo Logo" width="150" height="20">
    </div>

    <!-- Jakarta Clock -->
    <div class="jakarta-clock">
        <div>Jakarta, Indonesia</div>
        <div class="clock-time" id="jakarta-time"></div>
        <div class="clock-date" id="jakarta-date"></div>
    </div>

    <!-- Unit Converter -->
    <div class="unit-converter">
        <h3>Unit Converter</h3>
        <div class="converter-input">
            <input type="number" id="converterValue" placeholder="Value" value="1">
            <select id="converterFrom">
                <option value="mm">mm</option>
                <option value="cm">cm</option>
                <option value="inch">inch</option>
            </select>
        </div>
        <div class="converter-input">
            <input type="number" id="converterResult" placeholder="Result" readonly>
            <select id="converterTo">
                <option value="mm">mm</option>
                <option value="cm" selected>cm</option>
                <option value="inch">inch</option>
            </select>
        </div>
        <div class="converter-result" id="converterFormula"></div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <h2>Login Required</h2>
            <form class="login-form" onsubmit="return validateLogin()">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <div id="loginError" class="error-message">Invalid username or password</div>
        </div>
    </div>

    <!-- Add Option Modal -->
    <div id="addOptionModal" class="add-option-modal">
        <div class="add-option-content">
            <h2 id="addOptionTitle">Add New Option</h2>
            <form class="add-option-form" onsubmit="return saveNewOption()">
                <div id="categorySelection" style="display: none;">
                    <label for="parentCategory">Category</label>
                    <select id="parentCategory" required>
                        <option value="">-- Select Category --</option>
                        <option value="01">01. Filter</option>
                        <option value="02">02. Sheetmetal</option>
                        <option value="03">03. Bahan baku</option>
                        <option value="04">04. Barang jadi</option>
                        <option value="05">05. Jasa</option>
                        <option value="06">06. Subcount</option>
                    </select>
                </div>
                <div id="subCategorySelection" style="display: none;">
                    <label for="parentSubCategory">Sub Category</label>
                    <select id="parentSubCategory" required>
                        <option value="">-- Select Sub Category --</option>
                    </select>
                </div>
                <div id="codeFieldGroup">
                    <label for="newOptionCode">Code</label>
                    <input type="text" id="newOptionCode">
                </div>
                <div>
                    <label for="newOptionName">Name</label>
                    <input type="text" id="newOptionName" required>
                </div>
                <div class="form-buttons">
                    <button type="submit">Save</button>
                    <button type="button" class="cancel-btn" onclick="closeAddOptionModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Content (hidden until login) -->
    <div id="mainContent" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>System Part Number Generator</h1>
            </div>
            
            <div class="section">
                <div class="section-title">Kategori</div>
                
                <div class="form-group">
                    <label for="category">Kategori</label>
                    <select id="category" onchange="updateSubCategories()">
                        <option value="">-- Pilih Kategori --</option>
                        <option value="01">01. Filter</option>
                        <option value="02">02. Sheetmetal</option>
                        <option value="03">03. Bahan baku</option>
                        <option value="04">04. Barang jadi</option>
                        <option value="05">05. Jasa</option>
                        <option value="06">06. Subcount</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subCategory">Sub Kategori</label>
                    <div class="dropdown-with-add">
                        <select id="subCategory" onchange="updateProductNames()" disabled>
                            <option value="">-- Pilih Sub Kategori --</option>
                        </select>
                        <button class="add-btn" onclick="showAddOptionModal('subCategory')">+</button>
                    </div>
                </div>
                
                <div class="form-group" id="productNameGroup">
                    <label for="productName">Nama Product</label>
                    <div class="dropdown-with-add">
                        <select id="productName" onchange="updateMaterialOptions()" disabled>
                            <option value="">-- Pilih Nama Product --</option>
                        </select>
                        <button class="add-btn" onclick="showAddOptionModal('productName')">+</button>
                    </div>
                </div>
                
                <!-- Header Type Input -->
                <div class="form-group header-type-input" id="headerTypeGroup">
                    <label for="headerType">Tipe Header</label>
                    <select id="headerType">
                        <option value="1">1. Non Header</option>
                        <option value="2">2. Single Header</option>
                        <option value="3">3. Double Header</option>
                    </select>
                </div>
                
                <div class="form-group" id="materialGroup">
                    <label for="material">Bahan/Media Utama</label>
                    <div class="dropdown-with-add">
                        <select id="material" disabled>
                            <option value="">-- Pilih Bahan/Media --</option>
                        </select>
                        <button class="add-btn" id="materialAddBtn" onclick="showAddOptionModal('material')" disabled>+</button>
                    </div>
                </div>

                <!-- Pocket Input Field -->
                <div class="form-group pocket-input" id="pocketInputGroup">
                    <label for="pocketCount">Number of Pockets</label>
                    <input type="number" id="pocketCount" min="1" value="1">
                </div>
            </div>
            
            <!-- Regular Dimensions Section -->
            <div class="section" id="regularDimensions">
                <div class="section-title">Ukuran (mm)</div>
                <div class="form-group">
                    <div class="dimensions">
                        <div class="dimension-input">
                            <label for="length">Panjang</label>
                            <input type="number" id="length" min="0">
                        </div>
                        <div class="dimension-input">
                            <label for="width">Lebar</label>
                            <input type="number" id="width" min="0">
                        </div>
                        <div class="dimension-input">
                            <label for="height">Tinggi</label>
                            <input type="number" id="height" min="0">
                        </div>
                    </div>
                    <button class="generate-size-btn" onclick="generateSizeCode()">Generate Size Code</button>
                </div>
                <div class="form-group">
                    <label for="sizeCode">Kode Ukuran</label>
                    <input type="text" id="sizeCode" readonly>
                </div>
            </div>
            
            <!-- Cartridge Dimensions Section -->
            <div class="section cartridge-dimensions" id="cartridgeDimensions">
                <div class="section-title">Dimensi Cartridge (mm)</div>
                <div class="form-group">
                    <div class="cartridge-dimension-group">
                        <div class="cartridge-dimension-input">
                            <label for="internalTop">Internal Dimension Top</label>
                            <input type="number" id="internalTop" min="0">
                        </div>
                        <div class="cartridge-dimension-input">
                            <label for="internalBottom">Internal Dimension Bottom</label>
                            <input type="number" id="internalBottom" min="0">
                        </div>
                    </div>
                    <div class="cartridge-dimension-group">
                        <div class="cartridge-dimension-input">
                            <label for="externalTop">External Dimension Top</label>
                            <input type="number" id="externalTop" min="0">
                        </div>
                        <div class="cartridge-dimension-input">
                            <label for="externalBottom">External Dimension Bottom</label>
                            <input type="number" id="externalBottom" min="0">
                        </div>
                    </div>
                    <div class="cartridge-dimension-group">
                        <div class="cartridge-dimension-input">
                            <label for="cartridgeLength">Length (Top to Bottom)</label>
                            <input type="number" id="cartridgeLength" min="0">
                        </div>
                    </div>
                    <button class="generate-size-btn" onclick="generateSizeCode()">Generate Size Code</button>
                </div>
                <div class="form-group">
                    <label for="cartridgeSizeCode">Kode Ukuran</label>
                    <input type="text" id="cartridgeSizeCode" readonly>
                </div>
            </div>
            
            <!-- Order Number Section for Raw Materials -->
            <div class="section" id="orderNumberSection" style="display: none;">
                <div class="section-title">Nomor Order (PO)</div>
                <div class="form-group">
                    <label for="orderNumber">Nomor Order</label>
                    <input type="text" id="orderNumber">
                </div>
            </div>
            
            <div class="form-group">
                <label for="price">Harga Rp.</label>
                <input type="number" id="price" min="0">
            </div>
            
            <div class="generate-section">
                <button onclick="generatePartNumber()">Generate Part Number</button>
            </div>
            
            <div class="result" id="result" style="display: none;">
                <div class="form-group">
                    <label for="partNumber">Part Number</label>
                    <div class="flex-row">
                        <input type="text" id="partNumber" readonly style="flex: 1;">
                        <button class="copy-btn" onclick="copyToClipboard('partNumber')">Copy</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>QR Code Data</label>
                    <div class="flex-row">
                        <input type="text" id="qrData" readonly style="flex: 1;">
                        <button class="copy-btn" onclick="copyToClipboard('qrData')">Copy</button>
                    </div>
                    <div class="qr-container">
                        <div id="qr-code"></div>
                        <div class="save-buttons">
                            <button class="save-btn" onclick="saveQRCode('png')">Save as PNG</button>
                            <button class="save-btn" onclick="saveQRCode('jpeg')">Save as JPEG</button>
                        </div>
                        <div class="qr-value" id="qr-text"></div>
                    </div>
                </div>
            </div>
            
            <div class="section data-section">
                <div class="section-title">Data Part Number</div>
                
                <!-- Search Container -->
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search by part number, product, etc...">
                    <button onclick="searchTable()">Search</button>
                </div>
                
                <div class="category-tabs" id="categoryTabs">
                    <button class="category-tab active" onclick="filterDataTable('all')">Semua</button>
                    <button class="category-tab" onclick="filterDataTable('F1')">Filter</button>
                    <button class="category-tab" onclick="filterDataTable('F2')">Sheetmetal</button>
                    <button class="category-tab" onclick="filterDataTable('F3')">Bahan baku</button>
                    <button class="category-tab" onclick="filterDataTable('F6')">Barang jadi</button>
                    <button class="category-tab" onclick="filterDataTable('F5')">Jasa</button>
                    <button class="category-tab" onclick="filterDataTable('F4')">Subcount</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Part Number</th>
                                <th>Kategori</th>
                                <th>Sub Kategori</th>
                                <th>Produk</th>
                                <th>Material</th>
                                <th>Ukuran</th>
                                <th>Harga</th>
                                <th>Header Type</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="10" class="no-data">Belum ada data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="clear-data-btn" onclick="clearAllData()">Clear All Data</button>
                    <button class="export-btn" onclick="exportToExcel()">Export to Excel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Clock function for Jakarta, Indonesia (GMT+7)
        function updateJakartaClock() {
            const options = {
                timeZone: 'Asia/Jakarta',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            
            const now = new Date();
            const jakartaTime = now.toLocaleTimeString('id-ID', {
                timeZone: 'Asia/Jakarta',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const jakartaDate = now.toLocaleDateString('id-ID', {
                timeZone: 'Asia/Jakarta',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('jakarta-time').textContent = jakartaTime;
            document.getElementById('jakarta-date').textContent = jakartaDate;
        }
        
        // Update clock every second
        setInterval(updateJakartaClock, 1000);
        updateJakartaClock(); // Initial call

        // Category mappings for new part number format
        const categoryMappings = {
            '01': { prefix: 'F1', name: 'Filter' },
            '02': { prefix: 'F2', name: 'Sheetmetal' },
            '03': { prefix: 'F3', name: 'Raw Material' },
            '04': { prefix: 'F6', name: 'Finished Goods' },
            '05': { prefix: 'F5', name: 'Service' },
            '06': { prefix: 'F4', name: 'Subcount' }
        };

        // Data structure for saved options
        let savedOptions = {
            categories: [],
            subCategories: {},
            productNames: {},
            materials: []
        };

        // Default data structures
        const defaultSubCategories = {
            '01': [
                {value: '01', text: '01. Pre Filter'},
                {value: '02', text: '02. Medium Filter'},
                {value: '03', text: '03. Hepa Filter'},
                {value: '04', text: '04. Ulpa Filter'},
                {value: '05', text: '05. Cartridge Filter Gasturbine'}
            ],
            '02': [
                {value: '01', text: '01. HVAC Equipment'},
                {value: '02', text: '02. Hospital'},
                {value: '03', text: '03. Accessories'}
            ],
            '03': [
                {value: '01', text: '01. Lokal'},
                {value: '02', text: '02. Impor'}
            ],
            '04': [],
            '05': [],
            '06': []
        };
        
        const defaultProductNames = {
            '01-01': [
                {value: '01', text: 'NAF CR Pre Filter Washable Pleated Radial'},
                {value: '02', text: 'NAF CR Pre Filter Washable Flat'},
                {value: '03', text: 'Pre Filter NAF 30 (Disposable)'},
                {value: '04', text: 'NAF CR Pre Filter Washable Flange Type'},
                {value: '05', text: 'NAF CR Prefilter IU'},
                {value: '06', text: 'NAF Multi Pocket Filter / Medium Bag Filter'}
            ],
            '01-02': [
                {value: '01', text: 'NAF V-PAC (2V)'},
                {value: '02', text: 'NAF V Bank Carbon Filter Active 3V'},
                {value: '03', text: 'NAF V-PAC Carbon Filter'},
                {value: '04', text: 'NAF V-PAC Medium Filter'},
                {value: '05', text: 'NAF Rigid Flange Type Stainless Steel'},
                {value: '06', text: 'NAF RIGID Medium Filter'},
                {value: '07', text: 'NAF Multi Pocket Filter / Medium Bag Filter'},
                {value: '08', text: 'NAF Multi Pocket Airweb'},
                {value: '09', text: 'NAF ECO PAC Series Cardboard'},
                {value: '10', text: 'NAF ECO PAC Series Metal'},
                {value: '11', text: 'NAF PAC'},
                {value: '12', text: 'NAF PAC Wooden Frame'},
                {value: '13', text: 'Medium Filter Carbon Multi Layer (3 Stage)'}
            ],
            '01-03': [
                {value: '01', text: 'NAF Absolute MX'},
                {value: '02', text: 'NAF Absolute HEPA Minipleat XL – Deep 12 Inch'},
                {value: '03', text: 'NAF Absolute HEPA Minipleat XL – Deep 6 Inch'},
                {value: '04', text: 'NAF Absolute XL | HEPA Filter High Capacity (Aluminium Separator)'},
                {value: '05', text: 'NAF Absolute HEPA Filter Gel'},
                {value: '06', text: 'NAF Absolute HEPA V-Type'}
            ],
            '01-04': [
                {value: '01', text: 'NAF V-PAC GT'},
                {value: '02', text: 'NAF PAC GT'},
                {value: '03', text: 'NAF HP GT'},
                {value: '04', text: 'NAF 30 GT'},
                {value: '05', text: 'NAF RIGID GT'},
                {value: '06', text: 'NAF Profile Square End Cap Cartridge Filter'},
                {value: '07', text: 'NAF Profile Cylindrical Cartridge Filter'},
                {value: '08', text: 'NAF Profile Conical Cartridge Filter'},
                {value: '09', text: 'NAF Profile Spunbond Cartridge Filter'}
            ],
            '01-05': [
                {value: '01', text: 'Filter paper Media SK7538 ADWRC'},
                {value: '02', text: 'Filter Media Paper SK7538 ADWRC/HNV (Ex-China)'},
                {value: '03', text: 'Filter Media Paper type RF-3134 CWI (RF Ex-China)'},
                {value: '04', text: 'G.2260-15 AXSTAR Japan Spunbond'}
            ],
            '02-01': [
                {value: '01', text: 'Air Shower Cleanroom'},
                {value: '02', text: 'Pass Box Stainless Cleanroom'},
                {value: '03', text: 'Passbox Air Shower'},
                {value: '04', text: 'Dynamic Passbox Stainless Steel'},
                {value: '05', text: 'Laminar Air Flow / Biological Safety Cabinet (BSC)'},
                {value: '06', text: 'Economic Fan Filter Unit'},
                {value: '07', text: 'Fan Filter Unit'},
                {value: '08', text: 'Fan Filter Unit - American Louver Grille'},
                {value: '09', text: 'NAF Absolute HEPA Ceiling Module Housing Filter'},
                {value: '10', text: 'Side Access Housing Filter'},
                {value: '11', text: 'Supply Air Grille'},
                {value: '12', text: 'Swirl Diffuser Grille'}
            ],
            '02-02': [
                {value: '01', text: 'BIBO Filter Housing'},
                {value: '02', text: 'Air Purifier HEPA 3 IN 1 Unit'},
                {value: '03', text: 'Ranjang Periksa Pasien Stainless Steel'},
                {value: '04', text: 'Troll Tabung Oksigen Stainless Steel'},
                {value: '05', text: 'Meja Stainless Steel'},
                {value: '06', text: 'Rak Sepatu Industri Stainless Steel'},
                {value: '07', text: 'Troll Barang Lipat Stainless Steel'}
            ],
            '02-03': [
                {value: '01', text: 'Fan / Kipas / Blower untuk Fan Filter Unit (FFU)'},
                {value: '02', text: 'Farripulse Diaphragm Valve RMF - 45T'},
                {value: '03', text: 'Hinge Door / Engsel Pintu Jendela Passbox'},
                {value: '04', text: 'Jual Dwyer Magnchelic Original (Differential Pressure Gage)'},
                {value: '05', text: 'Jual Dwyer Minihetic II Original (Differential Pressure Gage 2)'},
                {value: '06', text: 'Motor Rotor Centrifugal Blower Air Shower'}
            ],
            '03-01': [
                {value: '01', text: '01. Bahan utama'},
                {value: '02', text: '02. Bahan pembantu'},
                {value: '03', text: '03. Bahan biaya'},
                {value: '04', text: '04. Bahan jasa'}
            ],
            '03-02': [
                {value: '01', text: '01. Bahan utama'},
                {value: '02', text: '02. Bahan pembantu'},
                {value: '03', text: '03. Bahan biaya'},
                {value: '04', text: '04. Bahan jasa'}
            ],
            '04': [],
            '05': [],
            '06': []
        };

        // Products that require header type selection
        const headerTypeProducts = ['06', '11', '04', '02', '03', '04', '02', '05'];

        // Media options classified by subcategory with codes
        const mediaOptionsBySubCategory = {
            '01': [ // Pre Filter
                {code: '01', name: 'G3 White Fabric'},
                {code: '02', name: 'G4 White Fabric'},
                {code: '03', name: 'Air Filter Media Blue'},
                {code: '04', name: 'Washable media filter non woven FNI IDN TH-350'},
                {code: '05', name: 'Washable media filter non woven 350 Sapta'},
                {code: '06', name: 'Washable Ex-China 350 FABRIC'},
                {code: '07', name: 'Washable 350G'},
                {code: '08', name: 'Washable Filter media T.15/500'},
                {code: '09', name: 'Washable Filter media 500 (sapta)'},
                {code: '10', name: 'Washable GA.160 T.14/G4'},
                {code: '11', name: 'Washable IDN 600'},
                {code: '12', name: 'Washable TH.150 T.11'},
                {code: '13', name: 'Washable VF 560 G'},
                {code: '14', name: 'Washable WF100 (Hight Temperature)'},
                {code: '15', name: 'G4 (ex china)'},
                {code: '16', name: 'AW TN40/10 size: 710 mm wide rolls (G4) Tangerding'}
            ],
            '02': [ // Medium Filter
                {code: '01', name: 'Air Filter Media; 90ASF804 (AHLSTROM) ASF Eff.95%COL'},
                {code: '02', name: 'Air Filter Media; 65ASF601 (AHLSTROM) ASF Eff.65%COL'},
                {code: '03', name: 'Air Filter Media / FibreGlass Paper F8 (China) Eff 65%'},
                {code: '04', name: 'Air Filter Media / FibreGlass Paper (Ahstrom) ADF Eff.65'},
                {code: '05', name: 'Media Filter F6 Single layer (Orange) Eff.65%'},
                {code: '06', name: 'Media Filter F7 Single layer (Pink)'},
                {code: '07', name: 'Media Filter F8 Single layer (yellow) Eff.95%'},
                {code: '08', name: 'Media Filter F.5 Double Layer (putih) eff.45%'},
                {code: '09', name: 'Media Filter F6 Double layer (Orange)'},
                {code: '10', name: 'Media Filter F7 Double layer (Pink) Eff.85%'},
                {code: '11', name: 'Media Filter F8 Double layer (yellow) Eff.95%'},
                {code: '12', name: 'Media Filter F.9 Double Layer (putih) Eff.98%'}
            ],
            '03': [ // HEPA Filter
                {code: '01', name: 'Air filter Media; HEPH1405 (AHLSTROM) 99,99%'},
                {code: '02', name: 'Air Filter Media / FibreGlass Paper H-14 (China-RF) Eff 99,996%'},
                {code: '03', name: 'Air Filter Media / FibreGlass Paper H-14 (China-Bashuo) Eff 99,996%'},
                {code: '04', name: 'Air filter Media hepa 90ASF9SP, ASHARE eff.98% (AHLSTROM)'},
                {code: '05', name: 'Synthetic Media / FibreGlass Paper H-11 Hepa (China) 95% DOP'},
                {code: '06', name: 'Air Filter Media / FibreGlass Paper H-11 (China-RF) Eff 95% DOP'}
            ],
            '04': [ // ULPA Filter
                {code: '01', name: 'Air Filter Media Ulpa / FibreGlass Paper (Ahlstrom) U15 99,999%'},
                {code: '02', name: 'Air Filter Media / FibreGlass Paper HA8603 (H&V )U15 99,999%'},
                {code: '03', name: 'Air Filter Media / FibreGlass Paper U 15 (China) 99,999%'}
            ],
            '05': [ // Cartridge Filter Gasturbine
                {code: '01', name: 'Filter paper Media SK7538 ADWRC'},
                {code: '02', name: 'Filter Media Paper SK7538 ADWRC/HNV (Ex-China)'},
                {code: '03', name: 'Filter Media Paper type. RF-3134 CWI (RF Ex-China)'},
                {code: '04', name: 'G.2260-15 AXSTAR Japan Spunbond'}
            ]
        };

        // Sheet metal materials with numbered codes
        const sheetMetalMaterials = [
            {code: '01', name: "PLAT MR SS304 #0.6MM 4' X 8'"},
            {code: '02', name: "PLAT MR SS304 #0.8MM 4' X 8'"},
            {code: '03', name: "PLAT MR SS304 #1MM 4' X 8'"},
            {code: '04', name: "PLAT MR SS304 #1.2MM 4' X 8'"},
            {code: '05', name: "PLAT MR SS304 #1.5MM 4' X 8'"},
            {code: '06', name: "PLAT MR SS304 #2MM 4' X 8'"},
            {code: '07', name: "PLAT MR SS304 #3MM 4' X 8'"},
            {code: '08', name: "PLAT HL SS304 #0.8MM 4' X 8'"},
            {code: '09', name: "PLAT HL SS304 #1MM 4' X 8'"},
            {code: '10', name: "PLAT HL SS304 #1.2MM 4' X 8'"},
            {code: '11', name: "PLAT HL SS304 #1.5MM 4' X 8'"},
            {code: '12', name: "PLAT HL SS304 #2MM 4' X 8'"},
            {code: '13', name: "PLAT HL SS304 #3MM 4' X 8'"},
            {code: '14', name: "PLAT 2B SS304 #0.8MM 4' X 8'"},
            {code: '15', name: "PLAT 2B SS304 #1MM 4' X 8'"},
            {code: '16', name: "PLAT 2B SS304 #1.2MM 4' X 8'"},
            {code: '17', name: "PLAT 2B SS304 #1.5MM 4' X 8'"},
            {code: '18', name: "PLAT 2B SS304 #2MM 4' X 8'"},
            {code: '19', name: "PLAT 2B SS304 #3MM 4' X 8'"},
            {code: '20', name: "PLAT 2B SS304 #4MM 4' X 8'"},
            {code: '21', name: "PLAT 2B SS201 #0.6MM 4' X 8'"},
            {code: '22', name: "PLAT 2B SS201 #0.8MM 4' X 8'"},
            {code: '23', name: "PLAT 2B SS201 #1MM 4' X 8'"},
            {code: '24', name: "PLAT 2B SS201 #1.2MM 4' X 8'"},
            {code: '25', name: "PLAT 2B SS201 #1.5MM 4' X 8'"},
            {code: '26', name: "PLAT 2B SS201 #2MM 4' X 8'"},
            {code: '27', name: "PLAT LUBANG SS304 DIAMETER 0.8 #0.8MM 4' X 8'"},
            {code: '28', name: "PLAT LUBANG SS304 DIAMETER 8MM #0.8MM 4' X 8'"},
            {code: '29', name: "PLAT LUBANG SS304 DIAMETER 8MM #1.2MM 4' X 8'"},
            {code: '30', name: "Plat Besi Hitam 1.2mm x 4ft x 8ft (STD)"},
            {code: '31', name: "Plat Besi Hitam 1.4mm x 4ft x 8ft (S)"},
            {code: '32', name: "Plat Besi Hitam 1.5mm x 4ft x 8ft (S)"},
            {code: '33', name: "Plat Besi Hitam 1.6mm x 4ft x 8ft (S)"},
            {code: '34', name: "Plat Besi Hitam 1.8mm x 4ft x 8ft (STD)"},
            {code: '35', name: "Plat Besi Hitam 2.0mm x 4ft x 8ft (STD)"}
        ];

        // Size code maps loaded from Google Sheets
        let sizeCodeMaps = {};
        let sizeCodeCounters = {};
        
        // Data storage
        let partNumberData = [];
        let currentDataId = 1;
        
        // Show login modal when page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginModal').style.display = 'block';
            loadSavedOptions();
            loadPartNumberData();
            loadSizeCodesFromSheets();
            setupUnitConverter();
        });

        // Setup unit converter
        function setupUnitConverter() {
            const converterValue = document.getElementById('converterValue');
            const converterFrom = document.getElementById('converterFrom');
            const converterTo = document.getElementById('converterTo');
            
            const updateConversion = () => {
                const value = parseFloat(converterValue.value) || 0;
                const fromUnit = converterFrom.value;
                const toUnit = converterTo.value;
                
                // Convert to mm first
                let valueInMm;
                switch(fromUnit) {
                    case 'mm': valueInMm = value; break;
                    case 'cm': valueInMm = value * 10; break;
                    case 'inch': valueInMm = value * 25.4; break;
                }
                
                // Convert from mm to target unit
                let result;
                switch(toUnit) {
                    case 'mm': result = valueInMm; break;
                    case 'cm': result = valueInMm / 10; break;
                    case 'inch': result = valueInMm / 25.4; break;
                }
                
                document.getElementById('converterResult').value = result.toFixed(4);
                
                // Show conversion formula
                let formula = '';
                if (fromUnit !== toUnit) {
                    formula = `${value} ${fromUnit} = ${result.toFixed(4)} ${toUnit}`;
                    if (fromUnit === 'inch' && toUnit === 'mm') formula += ` (×25.4)`;
                    if (fromUnit === 'mm' && toUnit === 'inch') formula += ` (÷25.4)`;
                    if (fromUnit === 'cm' && toUnit === 'mm') formula += ` (×10)`;
                    if (fromUnit === 'mm' && toUnit === 'cm') formula += ` (÷10)`;
                }
                document.getElementById('converterFormula').textContent = formula;
            };
            
            converterValue.addEventListener('input', updateConversion);
            converterFrom.addEventListener('change', updateConversion);
            converterTo.addEventListener('change', updateConversion);
            
            // Initial calculation
            updateConversion();
        }

        // Load size codes from Google Sheets
        function loadSizeCodesFromSheets() {
            // In a real implementation, this would fetch from Google Sheets
            // For now, we'll simulate with localStorage
            const savedSizeCodes = localStorage.getItem('sizeCodeData');
            if (savedSizeCodes) {
                const data = JSON.parse(savedSizeCodes);
                sizeCodeMaps = data.maps || {};
                sizeCodeCounters = data.counters || {};
            } else {
                // Initialize with default values
                sizeCodeMaps = {
                    'filter': {},
                    'sheetmetal': {},
                    'cartridge': {}
                };
                sizeCodeCounters = {
                    'filter': 1,
                    'sheetmetal': 1,
                    'cartridge': 1
                };
            }
        }

        // Save size codes to Google Sheets (simulated with localStorage)
        function saveSizeCodesToSheets() {
            const data = {
                maps: sizeCodeMaps,
                counters: sizeCodeCounters,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('sizeCodeData', JSON.stringify(data));
            
            // In a real implementation, this would send to Google Sheets
            console.log("Size codes saved (would send to Google Sheets in production)");
        }

        // Login validation
        function validateLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');
            
            if (username === 'Farrindo' && password === 'Farrindo365') {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                return false;
            } else {
                errorElement.style.display = 'block';
                return false;
            }
        }

        // Load saved options from localStorage
        function loadSavedOptions() {
            const savedData = localStorage.getItem('partNumberOptions');
            if (savedData) {
                savedOptions = JSON.parse(savedData);
                
                // Add saved categories to the dropdown
                savedOptions.categories.forEach(cat => {
                    addOptionToSelect('category', cat.value, cat.text);
                });
                
                // Add saved materials to the dropdown
                savedOptions.materials.forEach(mat => {
                    addOptionToSelect('material', mat, mat);
                });
            }
        }

        // Load part number data from localStorage
        function loadPartNumberData() {
            const savedData = localStorage.getItem('partNumberData');
            if (savedData) {
                partNumberData = JSON.parse(savedData);
                if (partNumberData.length > 0) {
                    currentDataId = Math.max(...partNumberData.map(item => item.id)) + 1;
                }
                updateDataTable();
            }
        }

        // Save options to localStorage
        function saveOptionsToStorage() {
            localStorage.setItem('partNumberOptions', JSON.stringify(savedOptions));
        }

        // Save part number data to localStorage
        function savePartNumberDataToStorage() {
            localStorage.setItem('partNumberData', JSON.stringify(partNumberData));
        }

        // Show add option modal
        let currentAddOptionType = '';
        function showAddOptionModal(type) {
            currentAddOptionType = type;
            const modal = document.getElementById('addOptionModal');
            const title = document.getElementById('addOptionTitle');
            const categorySelection = document.getElementById('categorySelection');
            const subCategorySelection = document.getElementById('subCategorySelection');
            const parentCategory = document.getElementById('parentCategory');
            const parentSubCategory = document.getElementById('parentSubCategory');
            const codeField = document.getElementById('newOptionCode');
            const nameField = document.getElementById('newOptionName');
            
            // Reset fields
            codeField.value = '';
            nameField.value = '';
            
            switch(type) {
                case 'category':
                    title.textContent = 'Add New Category';
                    categorySelection.style.display = 'none';
                    subCategorySelection.style.display = 'none';
                    codeField.style.display = 'block';
                    codeField.previousElementSibling.style.display = 'block';
                    break;
                    
                case 'subCategory':
                    title.textContent = 'Add New Sub Category';
                    categorySelection.style.display = 'block';
                    subCategorySelection.style.display = 'none';
                    codeField.style.display = 'block';
                    codeField.previousElementSibling.style.display = 'block';
                    
                    parentCategory.innerHTML = '<option value="">-- Select Category --</option>';
                    document.querySelectorAll('#category option').forEach(option => {
                        if (option.value) {
                            const newOption = document.createElement('option');
                            newOption.value = option.value;
                            newOption.textContent = option.text;
                            parentCategory.appendChild(newOption);
                        }
                    });
                    break;
                    
                case 'productName':
                    title.textContent = 'Add New Product Name';
                    categorySelection.style.display = 'block';
                    subCategorySelection.style.display = 'block';
                    codeField.style.display = 'block';
                    codeField.previousElementSibling.style.display = 'block';
                    
                    parentCategory.innerHTML = '<option value="">-- Select Category --</option>';
                    document.querySelectorAll('#category option').forEach(option => {
                        if (option.value) {
                            const newOption = document.createElement('option');
                            newOption.value = option.value;
                            newOption.textContent = option.text;
                            parentCategory.appendChild(newOption);
                        }
                    });
                    
                    parentSubCategory.innerHTML = '<option value="">-- Select Sub Category --</option>';
                    break;
                    
                case 'material':
                    title.textContent = 'Add New Material';
                    categorySelection.style.display = 'none';
                    subCategorySelection.style.display = 'none';
                    
                    // For materials, we only need the name field
                    codeField.style.display = 'none';
                    codeField.previousElementSibling.style.display = 'none';
                    
                    // Set the current sub-category as context for the new material
                    const currentSubCategory = document.getElementById('subCategory').value;
                    if (currentSubCategory) {
                        document.getElementById('parentSubCategory').value = currentSubCategory;
                    }
                    break;
            }
            
            modal.style.display = 'block';
        }

        // Close add option modal
        function closeAddOptionModal() {
            document.getElementById('addOptionModal').style.display = 'none';
        }

        // Update subcategory dropdown when parent category changes in add modal
        document.getElementById('parentCategory').addEventListener('change', function() {
            if (currentAddOptionType === 'productName') {
                const parentSubCategory = document.getElementById('parentSubCategory');
                const category = this.value;
                
                parentSubCategory.innerHTML = '<option value="">-- Select Sub Category --</option>';
                
                if (category) {
                    const defaultSubs = defaultSubCategories[category] || [];
                    const savedSubs = savedOptions.subCategories[category] || [];
                    const allSubs = [...defaultSubs, ...savedSubs];
                    
                    allSubs.forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub.value;
                        option.textContent = sub.text;
                        parentSubCategory.appendChild(option);
                    });
                }
            }
        });

        // Save new option
        function saveNewOption() {
            const code = document.getElementById('newOptionCode').value;
            const name = document.getElementById('newOptionName').value;
            
            if (currentAddOptionType === 'material' && !name) {
                alert('Please fill in the material name');
                return false;
            }
            
            if (currentAddOptionType !== 'material' && (!code || !name)) {
                alert('Please fill in both code and name');
                return false;
            }
            
            switch(currentAddOptionType) {
                case 'category':
                    const newCategory = {
                        value: code,
                        text: code + '. ' + name
                    };
                    savedOptions.categories.push(newCategory);
                    addOptionToSelect('category', newCategory.value, newCategory.text);
                    break;
                    
                case 'subCategory':
                    const parentCategory = document.getElementById('parentCategory').value;
                    if (!parentCategory) {
                        alert('Please select a category');
                        return false;
                    }
                    
                    const newSubCategory = {
                        value: code,
                        text: code + '. ' + name
                    };
                    
                    if (!savedOptions.subCategories[parentCategory]) {
                        savedOptions.subCategories[parentCategory] = [];
                    }
                    
                    savedOptions.subCategories[parentCategory].push(newSubCategory);
                    
                    if (document.getElementById('category').value === parentCategory) {
                        addOptionToSelect('subCategory', newSubCategory.value, newSubCategory.text);
                    }
                    break;
                    
                case 'productName':
                    const parentCategoryPN = document.getElementById('parentCategory').value;
                    const parentSubCategoryPN = document.getElementById('parentSubCategory').value;
                    
                    if (!parentCategoryPN || !parentSubCategoryPN) {
                        alert('Please select both category and subcategory');
                        return false;
                    }
                    
                    const newProductName = {
                        value: code,
                        text: name
                    };
                    
                    const key = parentCategoryPN + '-' + parentSubCategoryPN;
                    if (!savedOptions.productNames[key]) {
                        savedOptions.productNames[key] = [];
                    }
                    
                    savedOptions.productNames[key].push(newProductName);
                    
                    if (document.getElementById('category').value === parentCategoryPN && 
                        document.getElementById('subCategory').value === parentSubCategoryPN) {
                        addOptionToSelect('productName', newProductName.value, newProductName.text);
                    }
                    break;
                    
                case 'material':
                    const newMaterial = name;
                    const subCategory = document.getElementById('parentSubCategory').value;
                    
                    if (!subCategory) {
                        alert('Please select a sub-category first');
                        return false;
                    }
                    
                    // Only save if it's a valid material for this sub-category
                    const validMediaOptions = mediaOptionsBySubCategory[subCategory] || [];
                    if (!validMediaOptions.some(m => m.name === newMaterial)) {
                        savedOptions.materials.push(newMaterial);
                    }
                    
                    // Update the material dropdown if we're currently viewing this sub-category
                    const currentProduct = document.getElementById('productName').value;
                    if (currentProduct) {
                        addOptionToSelect('material', newMaterial, newMaterial);
                    }
                    break;
            }
            
            saveOptionsToStorage();
            closeAddOptionModal();
            return false;
        }

        // Add option to select dropdown
        function addOptionToSelect(selectId, value, text) {
            const select = document.getElementById(selectId);
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            select.appendChild(option);
            
            if (select.disabled && selectId !== 'category') {
                select.disabled = false;
            }
        }

        // Update sub categories dropdown
        function updateSubCategories() {
            const categorySelect = document.getElementById('category');
            const subCategorySelect = document.getElementById('subCategory');
            const productNameSelect = document.getElementById('productName');
            const productNameGroup = document.getElementById('productNameGroup');
            const materialSelect = document.getElementById('material');
            const materialGroup = document.getElementById('materialGroup');
            const materialAddBtn = document.getElementById('materialAddBtn');
            const pocketInputGroup = document.getElementById('pocketInputGroup');
            const headerTypeGroup = document.getElementById('headerTypeGroup');
            const regularDimensions = document.getElementById('regularDimensions');
            const cartridgeDimensions = document.getElementById('cartridgeDimensions');
            const orderNumberSection = document.getElementById('orderNumberSection');
            
            subCategorySelect.innerHTML = '<option value="">-- Pilih Sub Kategori --</option>';
            productNameSelect.innerHTML = '<option value="">-- Pilih Nama Product --</option>';
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            pocketInputGroup.style.display = 'none';
            headerTypeGroup.style.display = 'none';
            regularDimensions.style.display = 'block';
            cartridgeDimensions.style.display = 'none';
            orderNumberSection.style.display = 'none';
            
            const selectedCategory = categorySelect.value;
            
            if (selectedCategory) {
                subCategorySelect.disabled = false;
                
                const defaultSubs = defaultSubCategories[selectedCategory] || [];
                const savedSubs = savedOptions.subCategories[selectedCategory] || [];
                const allSubs = [...defaultSubs, ...savedSubs];
                
                allSubs.forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.value;
                    option.textContent = sub.text;
                    subCategorySelect.appendChild(option);
                });
                
                if (['01', '02', '03', '04'].includes(selectedCategory)) {
                    productNameGroup.style.display = 'block';
                    materialGroup.style.display = 'block';
                } else {
                    productNameGroup.style.display = 'none';
                    materialGroup.style.display = 'none';
                }
                
                // Show order number section for raw materials
                if (selectedCategory === '03') {
                    orderNumberSection.style.display = 'block';
                    regularDimensions.style.display = 'none';
                }
            } else {
                subCategorySelect.disabled = true;
                productNameSelect.disabled = true;
                materialSelect.disabled = true;
                materialAddBtn.disabled = true;
                productNameGroup.style.display = 'none';
                materialGroup.style.display = 'none';
            }
        }
        
        // Update product names dropdown
        function updateProductNames() {
            const categorySelect = document.getElementById('category');
            const subCategorySelect = document.getElementById('subCategory');
            const productNameSelect = document.getElementById('productName');
            const materialSelect = document.getElementById('material');
            const materialAddBtn = document.getElementById('materialAddBtn');
            const pocketInputGroup = document.getElementById('pocketInputGroup');
            const headerTypeGroup = document.getElementById('headerTypeGroup');
            const regularDimensions = document.getElementById('regularDimensions');
            const cartridgeDimensions = document.getElementById('cartridgeDimensions');
            
            productNameSelect.innerHTML = '<option value="">-- Pilih Nama Product --</option>';
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            pocketInputGroup.style.display = 'none';
            headerTypeGroup.style.display = 'none';
            regularDimensions.style.display = 'block';
            cartridgeDimensions.style.display = 'none';
            
            const selectedCategory = categorySelect.value;
            const selectedSubCategory = subCategorySelect.value;
            
            if (selectedCategory && selectedSubCategory) {
                productNameSelect.disabled = false;
                
                const key = selectedCategory + '-' + selectedSubCategory;
                const defaultProducts = defaultProductNames[key] || [];
                const savedProducts = savedOptions.productNames[key] || [];
                const allProducts = [...defaultProducts, ...savedProducts];
                
                allProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.value;
                    option.textContent = product.text;
                    productNameSelect.appendChild(option);
                });
                
                // Enable material add button only for Filter category (01)
                materialAddBtn.disabled = selectedCategory !== '01';
                
                // Show header type dropdown for specific products
                const selectedProduct = productNameSelect.value;
                if (headerTypeProducts.includes(selectedProduct)) {
                    headerTypeGroup.style.display = 'block';
                }
            } else {
                productNameSelect.disabled = true;
                materialSelect.disabled = true;
                materialAddBtn.disabled = true;
            }
        }

        // Update material options dropdown based on selected product
        function updateMaterialOptions() {
            const productNameSelect = document.getElementById('productName');
            const materialSelect = document.getElementById('material');
            const materialAddBtn = document.getElementById('materialAddBtn');
            const pocketInputGroup = document.getElementById('pocketInputGroup');
            const headerTypeGroup = document.getElementById('headerTypeGroup');
            const regularDimensions = document.getElementById('regularDimensions');
            const cartridgeDimensions = document.getElementById('cartridgeDimensions');
            
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            pocketInputGroup.style.display = 'none';
            headerTypeGroup.style.display = 'none';
            regularDimensions.style.display = 'block';
            cartridgeDimensions.style.display = 'none';
            
            const selectedProduct = productNameSelect.value;
            const selectedCategory = document.getElementById('category').value;
            const selectedSubCategory = document.getElementById('subCategory').value;
            
            if (selectedProduct) {
                materialSelect.disabled = false;
                
                // Show header type dropdown for specific products
                if (headerTypeProducts.includes(selectedProduct)) {
                    headerTypeGroup.style.display = 'block';
                }
                
                // Check if this is a cartridge filter product
                const cartridgeProducts = ['06', '07', '08', '09'];
                if (cartridgeProducts.includes(selectedProduct) && selectedSubCategory === '05') {
                    regularDimensions.style.display = 'none';
                    cartridgeDimensions.style.display = 'block';
                }
                
                // Handle sheet metal materials differently
                if (selectedCategory === '02') {
                    sheetMetalMaterials.forEach(material => {
                        const option = document.createElement('option');
                        option.value = material.code;
                        option.textContent = material.name;
                        materialSelect.appendChild(option);
                    });
                    materialAddBtn.disabled = true;
                } else if (selectedCategory === '01') {
                    // Get the appropriate media options based on subcategory
                    const mediaOptions = mediaOptionsBySubCategory[selectedSubCategory] || [];
                    
                    // Also include any saved materials
                    const savedMaterials = savedOptions.materials;
                    
                    // Add all available options to the dropdown
                    mediaOptions.forEach(material => {
                        const option = document.createElement('option');
                        option.value = material.name;
                        option.textContent = material.name;
                        materialSelect.appendChild(option);
                    });
                    
                    savedMaterials.forEach(material => {
                        const option = document.createElement('option');
                        option.value = material;
                        option.textContent = material;
                        materialSelect.appendChild(option);
                    });
                    
                    // Show pocket input if this is a Multi Pocket Filter
                    const productName = productNameSelect.options[productNameSelect.selectedIndex].text;
                    if (productName.includes('Multi Pocket Filter')) {
                        pocketInputGroup.style.display = 'block';
                    }
                    
                    // Enable the add button
                    materialAddBtn.disabled = false;
                } else if (selectedCategory === '03') {
                    // For raw materials, change to text input
                    materialSelect.innerHTML = '';
                    materialSelect.disabled = true;
                    materialAddBtn.disabled = true;
                    
                    // Create a text input for raw materials
                    const materialInput = document.createElement('input');
                    materialInput.type = 'text';
                    materialInput.id = 'materialText';
                    materialInput.placeholder = 'Masukkan nama bahan';
                    
                    // Replace the select with input
                    const materialContainer = materialSelect.parentNode;
                    materialSelect.style.display = 'none';
                    materialContainer.appendChild(materialInput);
                } else {
                    // For other categories, enable material add button
                    materialAddBtn.disabled = false;
                }
            } else {
                materialSelect.disabled = true;
                materialAddBtn.disabled = true;
            }
        }

        // Generate size code based on dimensions
        function generateSizeCode() {
            const category = document.getElementById('category').value;
            const regularDimensions = document.getElementById('regularDimensions');
            const cartridgeDimensions = document.getElementById('cartridgeDimensions');
            const sizeCodeInput = document.getElementById('sizeCode');
            const cartridgeSizeCodeInput = document.getElementById('cartridgeSizeCode');
            
            if (category === '01') {
                // Check if we're dealing with cartridge dimensions
                if (cartridgeDimensions.style.display === 'block') {
                    const internalTop = document.getElementById('internalTop').value;
                    const internalBottom = document.getElementById('internalBottom').value;
                    const externalTop = document.getElementById('externalTop').value;
                    const externalBottom = document.getElementById('externalBottom').value;
                    const cartridgeLength = document.getElementById('cartridgeLength').value;
                    
                    if (internalTop && internalBottom && externalTop && externalBottom && cartridgeLength) {
                        const key = `${internalTop}x${internalBottom}x${externalTop}x${externalBottom}x${cartridgeLength}`;
                        
                        if (!sizeCodeMaps['cartridge']) {
                            sizeCodeMaps['cartridge'] = {};
                            sizeCodeCounters['cartridge'] = 1;
                        }
                        
                        if (!sizeCodeMaps['cartridge'][key]) {
                            sizeCodeMaps['cartridge'][key] = sizeCodeCounters['cartridge']++;
                        }
                        
                        cartridgeSizeCodeInput.value = `A${String(sizeCodeMaps['cartridge'][key]).padStart(3, '0')}`;
                    } else {
                        cartridgeSizeCodeInput.value = '';
                    }
                } else {
                    // Regular dimensions for filters
                    const length = document.getElementById('length').value;
                    const width = document.getElementById('width').value;
                    const height = document.getElementById('height').value;
                    
                    if (length && width && height) {
                        const key = `${length}x${width}x${height}`;
                        
                        if (!sizeCodeMaps['filter']) {
                            sizeCodeMaps['filter'] = {};
                            sizeCodeCounters['filter'] = 1;
                        }
                        
                        if (!sizeCodeMaps['filter'][key]) {
                            sizeCodeMaps['filter'][key] = sizeCodeCounters['filter']++;
                        }
                        
                        sizeCodeInput.value = `A${String(sizeCodeMaps['filter'][key]).padStart(3, '0')}`;
                    } else {
                        sizeCodeInput.value = '';
                    }
                }
            } else if (category === '02') {
                // Sheet metal dimensions
                const length = document.getElementById('length').value;
                const width = document.getElementById('width').value;
                const height = document.getElementById('height').value;
                
                if (length && width && height) {
                    const key = `${length}x${width}x${height}`;
                    
                    if (!sizeCodeMaps['sheetmetal']) {
                        sizeCodeMaps['sheetmetal'] = {};
                        sizeCodeCounters['sheetmetal'] = 1;
                    }
                    
                    if (!sizeCodeMaps['sheetmetal'][key]) {
                        sizeCodeMaps['sheetmetal'][key] = sizeCodeCounters['sheetmetal']++;
                    }
                    
                    sizeCodeInput.value = `A${String(sizeCodeMaps['sheetmetal'][key]).padStart(3, '0')}`;
                } else {
                    sizeCodeInput.value = '';
                }
            } else {
                // Other categories
                const length = document.getElementById('length').value;
                const width = document.getElementById('width').value;
                const height = document.getElementById('height').value;
                
                if (length && width && height) {
                    const key = `${length}x${width}x${height}`;
                    const categoryPrefix = categoryMappings[category].prefix.substring(1);
                    
                    if (!sizeCodeMaps[category]) {
                        sizeCodeMaps[category] = {};
                        sizeCodeCounters[category] = 1;
                    }
                    
                    if (!sizeCodeMaps[category][key]) {
                        sizeCodeMaps[category][key] = sizeCodeCounters[category]++;
                    }
                    
                    sizeCodeInput.value = `A${String(sizeCodeMaps[category][key]).padStart(3, '0')}`;
                } else {
                    sizeCodeInput.value = '';
                }
            }
            
            // Save size codes to Google Sheets
            saveSizeCodesToSheets();
        }

        // Generate the part number
        function generatePartNumber() {
            const category = document.getElementById('category').value;
            const subCategory = document.getElementById('subCategory').value;
            const productName = document.getElementById('productName').value;
            const material = document.getElementById('material').value;
            const materialText = document.getElementById('materialText') ? document.getElementById('materialText').value : '';
            const sizeCode = document.getElementById('sizeCode').value;
            const cartridgeSizeCode = document.getElementById('cartridgeSizeCode')
            const headerType = document.getElementById('headerType').value;
            const pocketCount = document.getElementById('pocketCount').value;
            const price = document.getElementById('price').value;
            const orderNumber = document.getElementById('orderNumber').value;
            
            // Validate required fields
            if (!category) {
                alert('Please select a category');
                return;
            }
            
            if (!subCategory) {
                alert('Please select a sub category');
                return;
            }
            
            // For categories 01-02, 04, product name is required
            if (['01', '02', '04'].includes(category) && !productName) {
                alert('Please select a product name');
                return;
            }
            
            // For category 01, material is required
            if (category === '01' && !material && !materialText) {
                alert('Please select or enter a material');
                return;
            }
            
            // For category 03, material text is required
            if (category === '03' && !materialText) {
                alert('Please enter a material name');
                return;
            }
            
            // For categories 01-02, size code is required
            if (['01', '02'].includes(category) && !sizeCode && !cartridgeSizeCode) {
                alert('Please generate a size code');
                return;
            }
            
            // For category 03, order number is required
            if (category === '03' && !orderNumber) {
                alert('Please enter an order number');
                return;
            }
            
            // Build the part number
            let partNumber = '';
            
            // Category prefix
            partNumber += categoryMappings[category].prefix;
            
            // Sub category
            partNumber += '-' + subCategory;
            
            // Product name
            if (productName) {
                partNumber += '-' + productName.padStart(2, '0');
            } else {
                partNumber += '-00';
            }
            
            // Material code (handle different approaches for different categories)
            if (category === '01') {
                // For filters, use the material code from the predefined list
                const subCatMedia = mediaOptionsBySubCategory[subCategory] || [];
                const materialObj = subCatMedia.find(m => m.name === material);
                
                if (materialObj) {
                    partNumber += '-' + materialObj.code.padStart(2, '0');
                } else {
                    // For custom materials, use a generic code
                    partNumber += '-99';
                }
            } else if (category === '02') {
                // For sheet metal, use the material code directly
                partNumber += '-' + material.padStart(2, '0');
            } else if (category === '03') {
                // For raw materials, use a fixed code based on subcategory
                partNumber += '-' + '01'; // Default code for raw materials
            } else {
                // For other categories, use a fixed code
                partNumber += '-' + '01';
            }
            
            // Size code
            if (cartridgeSizeCode) {
                partNumber += '-' + cartridgeSizeCode;
            } else if (sizeCode) {
                partNumber += '-' + sizeCode;
            } else {
                partNumber += '-A000';
            }
            
            // Header type (if applicable)
            const productSelect = document.getElementById('productName');
            const selectedProduct = productSelect.options[productSelect.selectedIndex].value;
            
            if (headerTypeProducts.includes(selectedProduct)) {
                partNumber += '-' + headerType;
            }
            
            // Pocket count (if applicable)
            const productNameText = productSelect.options[productSelect.selectedIndex].text;
            if (productNameText.includes('Multi Pocket Filter')) {
                partNumber += '-' + pocketCount.padStart(2, '0');
            }
            
            // For raw materials, add order number
            if (category === '03') {
                partNumber += '-' + orderNumber;
            }
            
            // Display the part number
            document.getElementById('partNumber').value = partNumber;
            document.getElementById('result').style.display = 'block';
            
            // Generate QR data
            const categoryName = document.getElementById('category').options[document.getElementById('category').selectedIndex].text;
            const subCategoryName = document.getElementById('subCategory').options[document.getElementById('subCategory').selectedIndex].text;
            const productNameText = document.getElementById('productName').options[document.getElementById('productName').selectedIndex]?.text || '';
            const materialName = category === '03' ? materialText : document.getElementById('material').options[document.getElementById('material').selectedIndex]?.text || '';
            
            let qrData = `Part Number: ${partNumber}\n`;
            qrData += `Category: ${categoryName}\n`;
            qrData += `Sub Category: ${subCategoryName}\n`;
            
            if (productNameText) {
                qrData += `Product: ${productNameText}\n`;
            }
            
            if (materialName) {
                qrData += `Material: ${materialName}\n`;
            }
            
            // Add dimensions to QR data
            if (category === '01' && document.getElementById('cartridgeDimensions').style.display === 'block') {
                qrData += `Internal Top: ${document.getElementById('internalTop').value}mm\n`;
                qrData += `Internal Bottom: ${document.getElementById('internalBottom').value}mm\n`;
                qrData += `External Top: ${document.getElementById('externalTop').value}mm\n`;
                qrData += `External Bottom: ${document.getElementById('externalBottom').value}mm\n`;
                qrData += `Length: ${document.getElementById('cartridgeLength').value}mm\n`;
            } else if (['01', '02'].includes(category)) {
                qrData += `Length: ${document.getElementById('length').value}mm\n`;
                qrData += `Width: ${document.getElementById('width').value}mm\n`;
                qrData += `Height: ${document.getElementById('height').value}mm\n`;
            }
            
            if (price) {
                qrData += `Price: Rp. ${parseInt(price).toLocaleString('id-ID')}\n`;
            }
            
            if (category === '03' && orderNumber) {
                qrData += `Order Number: ${orderNumber}\n`;
            }
            
            qrData += `Generated: ${new Date().toLocaleString('id-ID')}`;
            
            document.getElementById('qrData').value = qrData;
            document.getElementById('qr-text').textContent = qrData;
            
            // Generate QR code
            const qrContainer = document.getElementById('qr-code');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Save the part number data
            savePartNumberData(partNumber, categoryName, subCategoryName, productNameText, materialName, 
                              sizeCode || cartridgeSizeCode, price, headerType);
        }

        // Save part number data to storage and update table
        function savePartNumberData(partNumber, category, subCategory, product, material, size, price, headerType) {
            const newData = {
                id: currentDataId++,
                partNumber: partNumber,
                category: category,
                subCategory: subCategory,
                product: product,
                material: material,
                size: size,
                price: price ? `Rp. ${parseInt(price).toLocaleString('id-ID')}` : '-',
                headerType: headerType || '-',
                timestamp: new Date().toISOString()
            };
            
            partNumberData.push(newData);
            savePartNumberDataToStorage();
            updateDataTable();
        }

        // Update data table with all part numbers
        function updateDataTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            if (partNumberData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="no-data">Belum ada data</td></tr>';
                return;
            }
            
            partNumberData.forEach((data, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${data.partNumber}</td>
                    <td>${data.category}</td>
                    <td>${data.subCategory}</td>
                    <td>${data.product}</td>
                    <td>${data.material}</td>
                    <td>${data.size}</td>
                    <td>${data.price}</td>
                    <td>${data.headerType}</td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" onclick="viewData(${data.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteData(${data.id})">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Filter data table by category
        function filterDataTable(category) {
            const tabs = document.querySelectorAll('.category-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            event.target.classList.add('active');
            
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            let filteredData = partNumberData;
            
            if (category !== 'all') {
                filteredData = partNumberData.filter(data => data.partNumber.startsWith(category));
            }
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="no-data">Tidak ada data untuk kategori ini</td></tr>';
                return;
            }
            
            filteredData.forEach((data, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${data.partNumber}</td>
                    <td>${data.category}</td>
                    <td>${data.subCategory}</td>
                    <td>${data.product}</td>
                    <td>${data.material}</td>
                    <td>${data.size}</td>
                    <td>${data.price}</td>
                    <td>${data.headerType}</td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" onclick="viewData(${data.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteData(${data.id})">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Search table
        function searchTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            if (!searchTerm) {
                updateDataTable();
                return;
            }
            
            const filteredData = partNumberData.filter(data => 
                data.partNumber.toLowerCase().includes(searchTerm) ||
                data.category.toLowerCase().includes(searchTerm) ||
                data.subCategory.toLowerCase().includes(searchTerm) ||
                data.product.toLowerCase().includes(searchTerm) ||
                data.material.toLowerCase().includes(searchTerm)
            );
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="no-data">Tidak ada data yang cocok</td></tr>';
                return;
            }
            
            filteredData.forEach((data, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${data.partNumber}</td>
                    <td>${data.category}</td>
                    <td>${data.subCategory}</td>
                    <td>${data.product}</td>
                    <td>${data.material}</td>
                    <td>${data.size}</td>
                    <td>${data.price}</td>
                    <td>${data.headerType}</td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" onclick="viewData(${data.id})">View</button>
                        <button class="action-btn delete-btn" onclick="deleteData(${data.id})">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // View data details
        function viewData(id) {
            const data = partNumberData.find(item => item.id === id);
            if (!data) return;
            
            // Populate the form with the data
            // This would need to be implemented based on your specific data structure
            alert(`Viewing data: ${data.partNumber}\nCategory: ${data.category}\nProduct: ${data.product}`);
            
            // In a real implementation, you might want to show a modal with all details
            // or populate the form fields to allow editing
        }

        // Delete data
        function deleteData(id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            partNumberData = partNumberData.filter(item => item.id !== id);
            savePartNumberDataToStorage();
            updateDataTable();
        }

        // Clear all data
        function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL data? This cannot be undone.')) return;
            
            partNumberData = [];
            currentDataId = 1;
            savePartNumberDataToStorage();
            updateDataTable();
        }

        // Export to Excel
        function exportToExcel() {
            if (partNumberData.length === 0) {
                alert('No data to export');
                return;
            }
            
            // Prepare data for export
            const dataToExport = partNumberData.map(item => ({
                'Part Number': item.partNumber,
                'Category': item.category,
                'Sub Category': item.subCategory,
                'Product': item.product,
                'Material': item.material,
                'Size': item.size,
                'Price': item.price,
                'Header Type': item.headerType,
                'Generated Date': new Date(item.timestamp).toLocaleString('id-ID')
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Part Numbers');
            
            // Generate Excel file and download
            const date = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `Part_Numbers_${date}.xlsx`);
        }

        // Copy to clipboard
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            alert('Copied to clipboard');
        }

        // Save QR code as image
        function saveQRCode(format) {
            const qrContainer = document.getElementById('qr-code');
            
            html2canvas(qrContainer).then(canvas => {
                const link = document.createElement('a');
                const partNumber = document.getElementById('partNumber').value;
                
                link.download = `QR_${partNumber}.${format}`;
                link.href = canvas.toDataURL(`image/${format}`);
                link.click();
            });
        }
    </script>
</body>
</html>
